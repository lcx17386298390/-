<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../myCSS/search.css">
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.staticfile.org/vue/3.0.5/vue.global.js"></script>
    <script src="https://cdn.bootcss.com/jquery/3.5.0/jquery.js"></script>
    <title>搜索结果</title>
</head>
<body>
<div class="iframeDiv">
    <iframe frameboder="no" width="100%" height="800" src="/mine" ></iframe>
</div>
<div id="search">
    <div id="branch1" class="branch">
        <table class="searchTable">
            <tr>
                <th>航班号</th>
                <th>出发机场</th>
                <th>到达机场</th>
                <th>出发时间</th>
                <th>到达时间</th>
                <th>经济舱</th>
                <th>头等舱</th>
            </tr>
            <tr>
                <th id="number1"></th>
                <th id="originValue1"></th>
                <th id="destinationValue1"></th>
                <th id="departrueTime1"></th>
                <th id="arrivalTime1"></th>
                <th id="economySeat1"></th>
                <th id="firstSeat1"></th>
            </tr>
        </table>
        <div class="buttonDiv1">
            <button onclick="btn(1)" class="button">选购</button>
            <div class="buttonBuy1">
                <div class="leftBuy">
                    <span>经济舱</span>
                    <span id="economyPrice1"></span>
                    <button class="tableButton" onclick="economyBtn(1)">购买</button>
                </div>
                <div class="rightBuy">
                    <span>头等舱</span>
                    <span id="firstPrice1"></span>
                    <button class="tableButton" onclick="firstBtn(1)">购买</button>
                </div>
            </div>
        </div>
    </div>
    <div id="branch2" class="branch">
        <table class="searchTable">
            <tr>
                <th>航班号</th>
                <th>出发机场</th>
                <th>到达机场</th>
                <th>出发时间</th>
                <th>到达时间</th>
                <th>经济舱</th>
                <th>头等舱</th>
            </tr>
            <tr>
                <th id="number2"></th>
                <th id="originValue2"></th>
                <th id="destinationValue2"></th>
                <th id="departrueTime2"></th>
                <th id="arrivalTime2"></th>
                <th id="economySeat2"></th>
                <th id="firstSeat2"></th>
            </tr>
        </table>
        <div class="buttonDiv2">
            <button onclick="btn(2)" class="button">选购</button>
            <div class="buttonBuy2">
                <div class="leftBuy">
                    <span>经济舱</span>
                    <span id="economyPrice2"></span>
                    <button class="tableButton" onclick="economyBtn(2)">购买</button>
                </div>
                <div class="rightBuy">
                    <span>头等舱</span>
                    <span id="firstPrice2"></span>
                    <button class="tableButton" onclick="firstBtn(2)">购买</button>
                </div>
            </div>
        </div>
    </div>
    <div id="branch3" class="branch">
        <table class="searchTable">
            <tr>
                <th>航班号</th>
                <th>出发机场</th>
                <th>到达机场</th>
                <th>出发时间</th>
                <th>到达时间</th>
                <th>经济舱</th>
                <th>头等舱</th>
            </tr>
            <tr>
                <th id="number3"></th>
                <th id="originValue3"></th>
                <th id="destinationValue3"></th>
                <th id="departrueTime3"></th>
                <th id="arrivalTime3"></th>
                <th id="economySeat3"></th>
                <th id="firstSeat3"></th>
            </tr>
        </table>
        <div class="buttonDiv3">
            <button onclick="btn(3)" class="button">选购</button>
            <div class="buttonBuy3">
                <div class="leftBuy">
                    <span>经济舱</span>
                    <span id="economyPrice3"></span>
                    <button class="tableButton" onclick="economyBtn(3)">购买</button>
                </div>
                <div class="rightBuy">
                    <span>头等舱</span>
                    <span id="firstPrice3"></span>
                    <button class="tableButton" onclick="firstBtn(3)">购买</button>
                </div>
            </div>
        </div>
    </div>
    <div id="branch4" class="branch">
        <table class="searchTable">
            <tr>
                <th>航班号</th>
                <th>出发机场</th>
                <th>到达机场</th>
                <th>出发时间</th>
                <th>到达时间</th>
                <th>经济舱</th>
                <th>头等舱</th>
            </tr>
            <tr>
                <th id="number4"></th>
                <th id="originValue4"></th>
                <th id="destinationValue4"></th>
                <th id="departrueTime4"></th>
                <th id="arrivalTime4"></th>
                <th id="economySeat4"></th>
                <th id="firstSeat4"></th>
            </tr>
        </table>
        <div class="buttonDiv4">
            <button onclick="btn(4)" class="button">选购</button>
            <div class="buttonBuy4">
                <div class="leftBuy">
                    <span>经济舱</span>
                    <span id="economyPrice4"></span>
                    <button class="tableButton" onclick="economyBtn(4)">购买</button>
                </div>
                <div class="rightBuy">
                    <span>头等舱</span>
                    <span id="firstPrice4"></span>
                    <button class="tableButton" onclick="firstBtn(4)">购买</button>
                </div>
            </div>
        </div>
    </div>
    <div id="branch5" class="branch">
        <table class="searchTable">
            <tr>
                <th>航班号</th>
                <th>出发机场</th>
                <th>到达机场</th>
                <th>出发时间</th>
                <th>到达时间</th>
                <th>经济舱</th>
                <th>头等舱</th>
            </tr>
            <tr>
                <th id="number5"></th>
                <th id="originValue5"></th>
                <th id="destinationValue5"></th>
                <th id="departrueTime5"></th>
                <th id="arrivalTime5"></th>
                <th id="economySeat5"></th>
                <th id="firstSeat5"></th>
            </tr>
        </table>
        <div class="buttonDiv5">
            <button onclick="btn(5)" class="button">选购</button>
            <div class="buttonBuy5">
                <div class="leftBuy">
                    <span>经济舱</span>
                    <span id="economyPrice5"></span>
                    <button class="tableButton" onclick="economyBtn(5)">购买</button>
                </div>
                <div class="rightBuy">
                    <span>头等舱</span>
                    <span id="firstPrice5"></span>
                    <button class="tableButton" onclick="firstBtn(5)">购买</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    //经济舱价格
    let economyPrice = new Array()
    //头等舱价格
    let firstPrice = new Array()
    //返回的数据
    let resMes

    $(document).ready(
        function () {
            // let params = new URLSearchParams();
            axios.post("http://localhost:8080/search")
                .then(response => {
                    console.log(response)
                    resMes = response.data
                    let len = resMes.length;
                    for (let i = 1; i <= len; i++) {
                        document.getElementById("branch" + i).style.visibility = 'visible';
                    }
                    for (let i = 1; i <= len; i++) {
                        document.getElementById("economyPrice" + i).innerText = "¥" + resMes[i - 1].economyPrice
                        document.getElementById("firstPrice" + i).innerText = "¥" + resMes[i - 1].firstPrice
                        document.getElementById("number" + i).innerText = resMes[i - 1].number
                        document.getElementById("originValue" + i).innerText = resMes[i - 1].originAirport
                        document.getElementById("destinationValue" + i).innerText = resMes[i - 1].destinationAirport
                        document.getElementById("departrueTime" + i).innerText = resMes[i - 1].departureTime
                        document.getElementById("arrivalTime" + i).innerText = resMes[i - 1].arrivalTime
                        let economySeat = resMes[i - 1].economySeat
                        let firstSeat = resMes[i - 1].firstSeat

                        if (economySeat !== 0) {
                            document.getElementById("economySeat" + i).innerText = "有";
                        } else {
                            document.getElementById("economySeat" + i).innerText = "无";
                        }
                        if (firstSeat !== 0) {
                            document.getElementById("firstSeat" + i).innerText = "有";
                        } else {
                            document.getElementById("firstSeat" + i).innerText = "无";
                        }
                    }
                })
                .catch(error => {
                    console.log(error)
                    alert("有错误")
                })
        }
    )

    //购买经济舱按钮
    function economyBtn(i) {
        //航班序列号
        let serialNumber = resMes[i - 1].serialNumber
        // let params = new URLSearchParams()
        // //传入的是number航班号
        // params.append('number', number)
        // axios.post('http://localhost:8080/ticketBuyButton', params)
        //     .then(function (response) {
        //         console.log(response);
        //         if(response.data==="error"){
        //             alert("您已购买此航班或航班不存在")
        //         }else{
        //             alert("购买成功");
        //         }
        //     })
        //     .catch(error => {
        //         alert("有错误")
        //     })
        // window.document.location.href="http://localhost:8080/search?ticketNumber="+number
        let ticketType = "economySeat"
        //点击后跳转一个新页面，并且将购买的飞机序列号和机票类型直接放在路径上
        window.document.location.href="http://localhost:8080/buy?serialNumber="+serialNumber+"&ticketType="+ticketType
    }

    //购买头等舱按钮
    function firstBtn(i) {
        let serialNumber = resMes[i - 1].serialNumber
        //头等舱
        let ticketType = "firstSeat"
        window.document.location.href="http://localhost:8080/buy?serialNumber="+serialNumber+"&ticketType="+ticketType
    }

    // const app = {
    //     data() {
    //         return {
    //         }
    //     },
    //     methods:{
    //
    //     }
    // }
    // Vue.createApp(app).mount("#search");
</script>
</body>
</html>